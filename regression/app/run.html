<!DOCTYPE HTML>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>UITester run</title>
    <script charset="utf-8" src="http://assets.daily.taobao.net/p/uitest/src/jquery-1.7.2.min.js"></script>
</head>
<body>
<h3>UITester 运行页面</h3>
<p id="info"></p>

<script>
    var isRuning = false;
    jQuery("#info").html("空闲")
    jQuery(window).unload(function(e) {



        if(window.UT&&isRuning){
            UT.execute(function (report) {
                report.reports.errors.push({
                    message:url + "父页面异常跳转"
                })
                window.opener.socket.emit('console:task_finish', report);
            })
        }
        window.opener.win=null;

    });


    var test_start = function (url) {
        jQuery("#info").html("正在运行："+url)
        var loaded = false;
        isRuning = true;

        jQuery.getScript(url, function () {
            if (loaded)return;
            loaded = true;
            UT.execute(function (report) {

                window.opener.task_complete( report);
                isRuning = false;
                jQuery("#info").html("空闲")
            })
        })

        window.setTimeout(function () {
            if (loaded) return;

            loaded = true;

            var defaultResult = UT.defaultResult;
            defaultResult.reports.errors.push({
                message:url + "加载失败"
            })

            window.opener.task_complete(defaultResult);
            isRuning = false;
            jQuery("#info").html("空闲")


        }, 1000 * 10);





    }



</script>


</body>
</html>
